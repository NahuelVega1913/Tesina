<div class="bg-sky-100 min-h-screen">
  <div class="flex flex-col md:flex-row h- w-full p-4 gap-4">
    <div class="w-full md:w-3/5 p-1">
      <div id="default-carousel" class="relative w-full h-full">
        <!-- Carousel wrapper -->
        <div class="rounded-2xl bg-white h-1/1">
          <div class="relative h-56 overflow-hidden rounded-lg md:h-96">
            <!-- Carrusel funcional -->
            @if(repuesto != null && repuesto.urlImages?.length > 0){ @for (item
            of repuesto.urlImages; track $index) {
            <div
              class="{{
                currentImageIndex === $index ? 'block' : 'hidden'
              }} duration-700 ease-in-out"
              data-carousel-item
            >
              <img
                (error)="repuesto.urlImages[$index] = true"
                src="{{ item }}"
                class="block mx-auto max-h-100 sm:max-h-100 object-contain"
              />
            </div>
            } }
          </div>
          <!-- Slider indicators -->
          <div
            class="absolute z-30 flex -translate-x-1/2 bottom-5 left-1/2 space-x-3 rtl:space-x-reverse"
          >
            @for (item of repuesto.urlImages; track $index) {
            <button
              type="button"
              class="w-3 h-3 rounded-full"
              [ngClass]="{
                'bg-sky-800': currentImageIndex === $index,
                'bg-gray-300': currentImageIndex !== $index
              }"
              [attr.aria-label]="'Slide ' + ($index + 1)"
              (click)="currentImageIndex = $index"
            ></button>
            }
          </div>
          <!-- Slider controls -->
          @if(repuesto.urlImages.length > 1) {
          <button
            type="button"
            class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none text-black"
            (click)="
              currentImageIndex =
                currentImageIndex === 0
                  ? repuesto.urlImages.length - 1
                  : currentImageIndex - 1
            "
          >
            <span
              class="inline-flex items-center bg-gray-100 justify-center w-10 h-10 rounded-full group-hover:bg-white/50 group-focus:ring-4 group-focus:ring-white group-focus:outline-none"
            >
              <svg
                class="w-4 h-4 text-sky-950 rtl:rotate-180"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 6 10"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 1 1 5l4 4"
                />
              </svg>
              <span class="sr-only">Previous</span>
            </span>
          </button>
          <button
            type="button"
            class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none"
            (click)="
              currentImageIndex =
                currentImageIndex === repuesto.urlImages.length - 1
                  ? 0
                  : currentImageIndex + 1
            "
          >
            <span
              class="inline-flex items-center bg-gray-100 justify-center w-10 h-10 rounded-full group-hover:bg-white/50 group-focus:ring-4 group-focus:ring-white group-focus:outline-none"
            >
              <svg
                class="w-4 h-4 text-sky-950 rtl:rotate-180"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 6 10"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m1 9 4-4-4-4"
                />
              </svg>
              <span class="sr-only">Next</span>
            </span>
          </button>
          }
        </div>
      </div>
    </div>

    <div
      class="md:w-3xl flex flex-col h-full bg-white border-gray-600 p-5 rounded-2xl"
    >
      <p class="font-bold text-3xl mt-4">
        {{ repuesto.name }} ({{ repuesto.brand }})
      </p>
      <div class="flex items-center mb-2 mt-2">
        @if(repuesto.stars >=1){
        <svg
          class="w-4 h-4 text-sky-800 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }@else{
        <svg
          class="w-4 h-4 text-gray-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        } @if(repuesto.stars >=2){
        <svg
          class="w-4 h-4 text-sky-800 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }@else{
        <svg
          class="w-4 h-4 text-gray-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        } @if(repuesto.stars >=3){
        <svg
          class="w-4 h-4 text-sky-800 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }@else{
        <svg
          class="w-4 h-4 text-gray-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        } @if(repuesto.stars >=4){
        <svg
          class="w-4 h-4 text-sky-800 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }@else{
        <svg
          class="w-4 h-4 text-gray-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        } @if(repuesto.stars >= 5){
        <svg
          class="w-4 h-4 text-blue-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }@else{
        <svg
          class="w-4 h-4 text-gray-600 me-1"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 22 20"
        >
          <path
            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"
          />
        </svg>
        }

        <p class="ms-1 text-sm font-medium text-gray-500 text-gray-400">
          {{ repuesto.stars }}
        </p>
        <p class="ms-1 text-sm font-medium text-gray-500">de</p>
        <p class="ms-1 text-sm font-medium text-gray-500">5</p>
      </div>
      @if(repuesto.discaunt > 0){
      <p class="line-through font-medium text-gray-400 text-xs">
        $ {{ repuesto.price }}
      </p>
      }
      <p class="text-lg font-medium">
        $ {{ repuesto.price * (1 - repuesto.discaunt / 100) }}
      </p>
      @if(repuesto.discaunt > 0){
      <p class="text-green-500">{{ repuesto.discaunt }}% OFF</p>
      }
      <p class="font-extralight mb-2">Stock disponible</p>
      <div class="flex flex-row mt-3 mb-3">
        <label
          for="countries"
          class="block mb-2 text-sm font-medium me-2 text-gray-900"
          >Cantidad:</label
        >

        <select
          id="countries"
          [(ngModel)]="cantidad"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-1/5 p-2.5"
        >
          <option value="1" selected>1 Unidad</option>
          <option value="2">2 Unidades</option>
          <option value="3">3 Unidades</option>
          <option value="4">4 Unidades</option>
        </select>
      </div>
      <div class="font-light text-gray-500">
        +({{ repuesto.stock }} disponibles)
      </div>
      @if(this.rol != 'USER'){
      <button
        type="button"
        class="text-white mt-5 bg-sky-800 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2"
        (click)="abrirModalComprar()"
      >
        Comprar
      </button>
      }
      <div (click)="comprarRepuesto()" id="wallet_container" class="mt-1"></div>

      <button
        (click)="agregarAlCarrito()"
        type="button"
        class="text-sky-800 mt-1 bg-sky-100 hover:bg-blue-200 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 focus:outline-none"
      >
        Agregar al carrito
      </button>
    </div>
  </div>
  <div class="bg-white p-5 m-2 md-5 rounded-2xl shadow-md">
    <p class="text-3xl font-semibold">Descripción</p>
    <p class="mt-3 text-base">
      {{ repuesto.description }}
    </p>

    <p class="text-3xl font-semibold mt-5 mb-5">Preguntas y respuestas</p>
    @if(this.rol == 'USER') {
    <div class="flex flex-row p-5">
      <input
        type="text"
        [(ngModel)]="text"
        name="text"
        id="default-input"
        placeholder="Escribe tu pregunta..."
        class="bg-gray-50 m-1 h-10 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full"
      />

      <button
        type="button"
        (click)="sendComment()"
        class="focus:outline-none m-1 h-10 text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"
      >
        Comentar
      </button>
    </div>
    } @for (item of comments; track $index) {
    <div class="ms-3">
      <p class="text-md font-medium">{{ item.text }}</p>

      @if(item.response == null && this.rol == 'ADMIN') {
      <div class="flex flex-row p-5 align-middle">
        <svg
          class="w-6 h-6 mt-3 text-gray-800"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          width="10"
          height="10"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m9 5 7 7-7 7"
          />
        </svg>
        <input
          type="text"
          [(ngModel)]="text"
          name="text"
          id="default-input"
          placeholder="Escribe tu respuesta..."
          class="bg-gray-50 m-1 h-10 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full"
        />

        <button
          type="button"
          (click)="sendResponse(item.id)"
          class="focus:outline-none m-1 h-10 text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"
        >
          Responder
        </button>
      </div>
      } @if(item.response != null ) {
      <div class="flex flex-row ps-5">
        <div class="flex flex-row align-middle"></div>
        <svg
          class="w-6 h-6 text-gray-800"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          width="10 "
          height="10"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m9 5 7 7-7 7 "
          />
        </svg>
        <p class="text-md">{{ item.response }}</p>
      </div>
      }
    </div>
    }
  </div>
  <!-- Modal para seleccionar cliente (solo visible si showModalComprar es true) -->
  @if(showModalComprar) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
  >
    <div class="bg-white rounded-lg p-6 w-96">
      <h2 class="text-xl font-bold mb-4">Seleccione al cliente</h2>
      <select
        [(ngModel)]="usuarioSeleccionado"
        class="w-full mb-4 p-2 border border-gray-300 rounded"
      >
        @for (user of usuariosFicticios; track user.id) {
        <option [value]="user.email">
          {{ user.nombre }} {{ user.apellido }} ({{ user.email }})
        </option>
        }
      </select>
      <div class="flex justify-end gap-2">
        <button
          class="bg-gray-300 text-gray-700 px-4 py-2 rounded"
          (click)="cerrarModalComprar()"
        >
          Cancelar
        </button>
        <button
          class="bg-green-600 text-white px-4 py-2 rounded"
          (click)="confirmarCompraAdmin()"
          [disabled]="!usuarioSeleccionado"
        >
          Confirmar
        </button>
      </div>
    </div>
  </div>
  }
</div>
>
